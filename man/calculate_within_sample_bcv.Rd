% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{calculate_within_sample_bcv}
\alias{calculate_within_sample_bcv}
\title{Calculate within-sample BCV using pseudo-bulk groups}
\usage{
calculate_within_sample_bcv(
  seurat_obj,
  assay_name = "RNA",
  n_groups = 10,
  cells_per_group = NULL,
  min_cells_per_group = 50,
  min_counts = 10,
  robust = TRUE,
  seed = 42,
  feature_vector = NULL,
  vector_as = c("od", "ratio")
)
}
\arguments{
\item{seurat_obj}{A \code{\link[Seurat]{Seurat}} object containing single-cell
expression data.}

\item{assay_name}{Character scalar. The assay to use for counts extraction
(default: \code{"RNA"}).}

\item{n_groups}{Integer. Number of cell groups to form within the sample
(default: 10).}

\item{cells_per_group}{Integer. Number of cells per group; if \code{NULL},
will be determined based on \code{n_groups} and available cells.}

\item{min_cells_per_group}{Integer. Minimum number of cells per group
(default: 50).}

\item{min_counts}{Integer. Minimum total counts per gene across all groups
for the gene to be retained (default: 10).}

\item{robust}{Logical. Whether to use robust dispersion estimation in
\code{\link[edgeR]{estimateDisp}} (default: TRUE).}

\item{seed}{Integer. Random seed for reproducibility (default: 42).}

\item{feature_vector}{Optional numeric vector of per-gene values (named by
gene) to be applied as an offset in the model (e.g., overdispersion or
scaling ratios).}

\item{vector_as}{Character. Interpretation of \code{feature_vector}: either
\code{"od"} for overdispersion or \code{"ratio"} for scaling factors.}
}
\value{
A list with:
\describe{
\item{genes}{Character vector of retained gene IDs.}
\item{groups}{Character vector of group names.}
\item{n_cells_total}{Total number of cells in the Seurat object.}
\item{n_groups}{Number of groups after filtering.}
\item{cells_per_group}{Number of cells per group.}
\item{ave_log_cpm}{Average log2 counts per million (CPM) per gene.}
\item{bcv_tagwise}{Tagwise BCV estimates.}
\item{bcv_common}{Common BCV estimate.}
\item{bcv_trend}{Trended BCV estimates.}
\item{n_genes}{Number of genes retained.}
}
}
\description{
Forms within-sample pseudo-bulk groups from a Seurat object and estimates
the biological coefficient of variation (BCV) for each gene using edgeR.
}
\details{
This function:
\enumerate{
\item Subsamples cells into \code{n_groups} groups (via
\code{\link{subsample_cells_for_bcv}}).
\item Aggregates counts into group-level pseudo-bulk profiles (via
\code{\link{create_within_sample_pseudobulk}}).
\item Filters genes by total counts across groups.
\item Optionally applies a per-gene offset from a supplied feature vector.
\item Estimates tagwise, common, and trended dispersions using edgeR.
}

The biological coefficient of variation (BCV) is the square root of the
dispersion estimate and can be used to assess variability independent of
mean expression.
}
