% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{read_sample_data_improved}
\alias{read_sample_data_improved}
\title{Read sample count data and estimate integrated overdispersion}
\usage{
read_sample_data_improved(
  sample_id,
  base_dir,
  n_boot,
  gtf_file = NULL,
  transcript_info = NULL,
  block_cells = 128L,
  n_cores = max(1L, parallel::detectCores() - 1L),
  omp_threads = 1L,
  debug_first_block = FALSE
)
}
\arguments{
\item{sample_id}{Character, sample identifier (subdirectory name under
\code{base_dir}).}

\item{base_dir}{Character, path to the base directory containing sample
subdirectories with Alevin output.}

\item{n_boot}{Integer, number of bootstrap replicates per cell in the
Alevin output.}

\item{gtf_file}{Optional path to a GTF file for transcript complexity
calculation.}

\item{transcript_info}{Optional path to a transcript info table for
complexity calculation (must contain \code{gene_id} column).}

\item{block_cells}{Integer, number of cells per processing block for
bootstrap-based estimation.}

\item{n_cores}{Integer, number of parallel cores to use for processing.
Defaults to one less than the number of available cores.}

\item{omp_threads}{Integer, number of OpenMP threads to use for C++ code
(if applicable).}

\item{debug_first_block}{Logical, if \code{TRUE} only the first bootstrap
block is processed (for debugging).}
}
\value{
A list with elements:
\describe{
\item{\code{counts}}{Sparse counts matrix (genes x cells).}
\item{\code{od}}{Result list from \code{\link{estimate_overdispersion_integrated}}.}
\item{\code{feats}}{Character vector of gene names.}
\item{\code{cells}}{Character vector of cell barcodes.}
}
}
\description{
Loads a gene-by-cell count matrix for a given sample from Alevin output,
then computes integrated overdispersion estimates by combining bootstrap,
moment-based, and complexity prior methods.
}
\details{
This function reads the sparse counts matrix (\code{quants_mat.gz}) along
with its associated feature and cell name files from the specified Alevin
directory. The counts are loaded via \code{\link{read_eds_gc}} to ensure
dimension checks and logging.

After loading, \code{\link{estimate_overdispersion_integrated}} is called
to compute integrated overdispersion estimates, which combine:
\enumerate{
\item Bootstrap-based estimation from per-cell Alevin replicates.
\item Method-of-moments estimation from normalized counts.
\item A complexity prior from transcript annotation.
}
}
