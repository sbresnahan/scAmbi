% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{analyze_bcv_comprehensive}
\alias{analyze_bcv_comprehensive}
\title{Comprehensive BCV Analysis (Between- and Within-Sample)}
\usage{
analyze_bcv_comprehensive(
  objs,
  output_dir = "bcv_analysis_comprehensive",
  min_counts_between = 10,
  n_groups = 10,
  cells_per_group = NULL,
  min_cells_per_group = 50,
  min_counts_within = 10,
  robust = TRUE,
  save_plots = TRUE,
  run_diagnostics = TRUE,
  correction_method = c("auto", "offset_ratio", "offset_od", "direct", "offset_vector"),
  correction_vector_name = NULL,
  correction_vector_as = c("od", "ratio"),
  seed = 42
)
}
\arguments{
\item{objs}{Named list of \code{\link[Seurat]{Seurat}} objects.}

\item{output_dir}{Directory for saving outputs (plots, summaries, results).}

\item{min_counts_between}{Minimum counts threshold for between-sample BCV.}

\item{n_groups}{Number of cell groups per sample for within-sample BCV.}

\item{cells_per_group}{Optional fixed number of cells per group.}

\item{min_cells_per_group}{Minimum number of cells per group (within-sample).}

\item{min_counts_within}{Minimum counts threshold for within-sample BCV.}

\item{robust}{Logical; use robust dispersion estimation.}

\item{save_plots}{Logical; save generated plots to \code{output_dir}.}

\item{run_diagnostics}{Logical; run diagnostics to guide correction choice.}

\item{correction_method}{Correction method: \code{"auto"}, \code{"offset_ratio"},
\code{"offset_od"}, \code{"direct"}, or \code{"offset_vector"}.}

\item{correction_vector_name}{Optional; feature metadata column to use for
vector-based correction.}

\item{correction_vector_as}{Interpretation of \code{correction_vector_name}
when using \code{"offset_vector"}: \code{"od"} (overdispersion values) or
\code{"ratio"} (count ratios).}

\item{seed}{Random seed for reproducibility in within-sample grouping.}
}
\value{
A list with components:
\describe{
\item{results}{List with \code{between} and \code{within} BCV results.}
\item{plots}{List of \code{ggplot2} objects generated.}
\item{between_summary}{Summary table for between-sample BCV.}
\item{within_summary}{Summary table for within-sample BCV.}
\item{correction_method_used}{The correction method applied.}
\item{correction_vector_name}{The name of the feature vector used for correction, if any.}
\item{correction_vector_as}{Whether the correction vector was interpreted as "od" or "ratio".}
}
}
\description{
Performs a full Biological Coefficient of Variation (BCV) analysis for a list
of Seurat objects, including both between-sample and within-sample analyses.
Supports multiple correction methods for adjusted counts or offsets.
}
\details{
This function:
\enumerate{
\item Runs optional diagnostics to determine the most appropriate correction method.
\item Extracts pseudobulk counts for each assay.
\item Calculates between-sample BCV for RNA and corrected counts (if available).
\item Calculates within-sample BCV across cell groups per sample.
\item Generates BCV plots for each analysis.
\item Saves plots, RDS results, and summary tables if \code{save_plots = TRUE}.
}
}
\examples{
\dontrun{
results <- analyze_bcv_comprehensive(
  objs = seurat_list,
  output_dir = "bcv_output",
  correction_method = "auto"
)
}

}
\seealso{
\code{\link{calculate_bcv_direct}}, \code{\link{analyze_within_sample_bcv}},
\code{\link{plot_bcv}}, \code{\link{plot_within_sample_bcv}},
\code{\link{plot_between_vs_within_bcv}}, \code{\link{create_summary_table}}
}
