% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{calculate_bcv}
\alias{calculate_bcv}
\title{Calculate BCV with Optional Correction Offsets}
\usage{
calculate_bcv(
  pb_raw,
  pb_corr = NULL,
  overdispersion = NULL,
  feature_vector = NULL,
  vector_as = c("od", "ratio"),
  min_counts = 10,
  robust = TRUE,
  filter_method = c("rowSums", "filterByExpr"),
  offset_method = c("ratio", "vector", "overdispersion")
)
}
\arguments{
\item{pb_raw}{A raw pseudobulk count matrix (genes-by-samples).}

\item{pb_corr}{An optional corrected pseudobulk count matrix. Required if
\code{offset_method = "ratio"}.}

\item{overdispersion}{Deprecated. Use \code{feature_vector} instead. A named numeric
vector of per-gene overdispersion factors.}

\item{feature_vector}{A named numeric vector of per-gene values to be used as
an offset (e.g., overdispersion factors or scaling ratios).}

\item{vector_as}{How to interpret \code{feature_vector}: \code{"od"} (overdispersion) or
\code{"ratio"} (scaling factor).}

\item{min_counts}{Minimum total count for a gene to be included in the analysis.}

\item{robust}{Logical; whether to use robust dispersion estimation in \code{edgeR}.}

\item{filter_method}{Method for gene filtering: \code{"rowSums"} or \code{"filterByExpr"}.}

\item{offset_method}{The method for applying corrections:
\describe{
\item{\code{"ratio"}}{Calculates offsets from the log-ratio of corrected to raw counts (\code{log(pb_corr / pb_raw)}).}
\item{\code{"vector"}}{Calculates offsets from the provided \code{feature_vector}.}
\item{\code{"overdispersion"}}{Legacy alias for \code{"vector"} when using an overdispersion vector.}
}}
}
\value{
A list containing standard \code{edgeR} dispersion results, including
\code{bcv_tagwise}, \code{bcv_common}, \code{ave_log_cpm}, and other metrics.
}
\description{
Computes the Biological Coefficient of Variation (BCV) from a raw pseudobulk
count matrix, with the option to apply gene-specific offsets to model
technical variability (e.g., from overdispersion).
}
\details{
This function serves as the core of between-sample BCV analysis when
accounting for technical noise. By providing a \code{feature_vector} (like
scaling_factor), the \code{edgeR} model can distinguish biological
variability from known technical variance, ideally resulting in a lower and
more accurate BCV estimate.
}
\examples{
\dontrun{
# Assuming pb_raw is a raw counts matrix and od_vector contains per-gene OD
bcv_results_corrected <- calculate_bcv(
  pb_raw,
  feature_vector = od_vector,
  offset_method = "vector",
  vector_as = "od"
)
}
}
