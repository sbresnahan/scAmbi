% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/functions.R
\name{analyze_within_sample_bcv}
\alias{analyze_within_sample_bcv}
\title{Analyze Within-Sample BCV Across Multiple Seurat Objects}
\usage{
analyze_within_sample_bcv(
  seurat_list,
  assay_names = c("RNA", "RNA_corr"),
  n_groups = 10,
  cells_per_group = NULL,
  min_cells_per_group = 50,
  min_counts = 10,
  robust = TRUE,
  seed = 42,
  offset_vector_name = NULL,
  offset_vector_as = c("od", "ratio")
)
}
\arguments{
\item{seurat_list}{A named or unnamed list of Seurat objects to process.}

\item{assay_names}{Character vector of assay names to evaluate (default: \code{c("RNA","RNA_corr")}).}

\item{n_groups}{Integer, number of pseudobulk groups to create per sample (default: 10).}

\item{cells_per_group}{Optional integer specifying the number of cells per group;
if \code{NULL}, determined from \code{n_groups} and total cells.}

\item{min_cells_per_group}{Minimum number of cells allowed per pseudobulk group (default: 50).}

\item{min_counts}{Minimum total counts per gene across all groups to retain it for BCV
calculation (default: 10).}

\item{robust}{Logical, whether to use robust dispersion estimation in \code{edgeR} (default: TRUE).}

\item{seed}{Integer seed for reproducible grouping (default: 42).}

\item{offset_vector_name}{Optional character string naming a feature metadata vector
to use as an offset in BCV estimation (e.g., "scaling_factor").}

\item{offset_vector_as}{Character scalar, either \code{"od"} (interpret offset vector
as overdispersion factors) or \code{"ratio"} (interpret as multiplicative ratios
to adjust counts). Default is \code{"od"}.}
}
\value{
A named list, with one element per assay. Each element is itself a list of BCV
results for each sample, as returned by \code{\link{calculate_within_sample_bcv}},
augmented with the \code{sample_name}.
}
\description{
This function computes within-sample biological coefficient of variation (BCV)
metrics for each Seurat object in a list, optionally across multiple assays
(e.g., raw and overdispersion-corrected counts). BCV is estimated via
\code{\link{calculate_within_sample_bcv}} using pseudobulk replicates formed
by random subsampling of cells within each sample.
}
\details{
For each assay in each sample, cells are randomly assigned to \code{n_groups} pseudobulk
replicates. BCV is calculated across these replicates using edgeR's dispersion estimation.
If \code{offset_vector_name} is provided, the function will attempt to extract the
corresponding per-gene vector from the feature metadata of the first matching assay
found in the Seurat objects, and will pass it to \code{\link{calculate_within_sample_bcv}}.
}
\examples{
\dontrun{
results <- analyze_within_sample_bcv(
  seurat_list = list(sample1 = seu1, sample2 = seu2),
  assay_names = c("RNA", "RNA_corr"),
  n_groups = 8,
  offset_vector_name = "scaling_factor"
)
}

}
